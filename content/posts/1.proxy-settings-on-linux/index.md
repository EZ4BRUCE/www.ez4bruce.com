---
title: "1.æ”¾çœ¼çœ‹ä¸–ç•Œâ€”â€”è¯¦ç»†ä¸”å®ç”¨çš„linuxä»£ç†è®¾ç½®"
summary: "CFW / TUN Mode / proxychains / privoxy ç›¸å…³ä½¿ç”¨"
description: "CFW / TUN Mode / proxychains / privoxy"
date: 2022-03-19T14:30:00+08:00	# æ—¶é—´ä¸å¯¹å¯¼è‡´æ— æ³•è¯»å–
# weight: 1
# aliases: ["/1.æ”¾çœ¼çœ‹ä¸–ç•Œâ€”â€”è¯¦ç»†ä¸”å®ç”¨çš„linuxä»£ç†è®¾ç½®"]	# ä½¿ç”¨page bundlesï¼Œæ–‡ä»¶å¤¹åå°±æ˜¯alias
tags: ["linux","kubuntu","ç§‘å­¦ä¸Šç½‘","ç½‘ç»œç›¸å…³"]
categories: ["linux","ç§‘å­¦ä¸Šç½‘"]
author: "å¸ƒé²æ–¯çŒ«"
# author: ["Me", "You"] # multiple authors
draft: false
cover:
    image: "assets/nasa-Q1p7bh3SHj8-unsplash.jpg" # image path/url
    # alt: "<alt text>" # alt text
    # caption: "<text>" # display caption under cover
    relative: false # when using page bundles set this to true
    hidden: false # only hide on current single page

# editPost:
#     URL: "https://github.com/<path_to_repo>/content"
#     Text: "Suggest Changes" # edit text
#     appendFilePath: true # to append file path to Edit link

# å›ºå®šè®¾ç½®
hasCJKLanguage: true
showToc: true
TocSide: 'left'  # or 'right'
TocOpen: true
hidemeta: false
disableShare: false
hideSummary: false
searchHidden: false	# æ˜¯å¦è¦è¢«æœç´¢åˆ°
ShowReadingTime: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
---


## ç¼˜èµ·

è¿‡ä¸€æ®µæ—¶é—´åä¼šå»é¹…å‚å®ä¹ ï¼Œå¬åœ¨é‡Œé¢çš„å¥½å“¥å“¥è¯´ç°åœ¨å…¬å¸å˜æŠ é—¨äº†ï¼Œå®ä¹ ç”Ÿä¸ç»™å‘macäº†ï¼Œç„¶åä¸€ç›´ä»¥æ¥éƒ½åœ¨ windows ä¸Šè¸©äº†ä¸å°‘å‘ï¼Œé‚å†³å®šç”¨linuxå¼€å‘é€‚åº”ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœè¿˜å¯ä»¥çš„è¯åˆ°æ—¶å€™å®ä¹ å°±è‡ªå·±è£…ä¸€ä¸ªç”¨å’¯

å…¶å®ä¸€ç›´éƒ½æƒ³è¯•è¯•ï¼Œä½†ä¹‹å‰éƒ½æ²¡å•¥æ—¶é—´ï¼Œç°åœ¨åˆšå¥½æœ‰ä¸ªå®ä¹ å‰çš„ç©ºæ¡£æœŸï¼Œé‚£å°±æŠ˜è…¾ä¸€ä¸‹å§ã€‚å‘è¡Œç‰ˆé€‰æ‹©äº† kubuntuï¼ˆä¸»è¦æ˜¯è€ƒè™‘åˆ°ubuntuè¾ƒä¸ºæ–¹ä¾¿ã€ç¨³å®šï¼Œè€Œä¸ªäººåˆæ¯”è¾ƒå–œæ¬¢kdeï¼‰è£…å¥½ç³»ç»Ÿåï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯é…å¥½æ¢¯å­ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ç¯‡æ°´æ–‡ğŸ˜³



## ä»£ç† or é•œåƒæº

å½“æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨å„ç§æœåŠ¡æ—¶ï¼Œç»å¸¸ä¼šå› ä¸º [GFW](https://zh.wikipedia.org/wiki/%E9%98%B2%E7%81%AB%E9%95%BF%E5%9F%8E) çš„åŸå› ï¼Œé‡åˆ°ç§ç§ç½‘ç»œé—®é¢˜ï¼Œä½¿ç”¨é•œåƒæºä¸€èˆ¬èƒ½è§£å†³åŸºæœ¬çš„ä¸‹è½½é—®é¢˜ï¼ˆä¹Ÿæœ‰å¾ˆå¤šä¾‹å¤–æƒ…å†µï¼‰ï¼Œä½†æ˜¯æ²¡æœ‰æ™®é€‚æ€§è€Œä¸”ä¸ä¼˜é›…ï¼Œå‡å¦‚ä½ è¦ä¸‹è½½çš„åŒ…/æœåŠ¡åˆšå¥½é•œåƒæºæ²¡æœ‰å‘¢ï¼Ÿè€Œä¸”é•œåƒä¹Ÿä»…ä»…åªèƒ½æ»¡è¶³ä½ ä¸‹è½½çš„éœ€æ±‚ 

è€Œä¸ºä½ çš„å¼€å‘ç¯å¢ƒé…ç½®å¥½ä»£ç†æœåŠ¡èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜



## ç¯å¢ƒè¯´æ˜

æµ‹è¯•ç¯å¢ƒï¼š[kubuntu20.04LTS](https://kubuntu.org/) ã€[Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg) 

é…ç½®éœ€æ±‚ï¼šä»»æ„linuxå‘è¡Œç‰ˆã€æœºåœº or ä»£ç†

æ¨èåº”ç”¨ï¼š[Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg) ã€[proxychains-ng](https://github.com/rofl0r/proxychains-ng) ã€[privoxy](http://www.privoxy.org/)



## è®¤è¯†ä½ çš„ä»£ç†

>   æ¨èè¿™ç¯‡æ–‡ç« äº†è§£ä¸åŒçš„ç¿»å¢™åè®®ï¼š[ç§‘å­¦ä¸Šç½‘çš„ä¸»æµåè®®å¤§å¯¹æ¯”](https://www.techfens.com/posts/kexueshangwang.html)
>
>   ç”µä¸¸ç§‘æŠ€AKçš„é¢‘é“ï¼š[ã€Œç¡¬æ ¸ç¿»å¢™/ç§‘å­¦ä¸Šç½‘ã€ç³»åˆ—](https://www.youtube.com/watch?v=XKZM_AjCUr0&list=PLqybz7NWybwUgR-S6m78tfd-lV4sBvGFG)
>
>   æœºåœºçš„æµ‹é€Ÿä¸é€‰æ‹©ï¼š[DuyaoSS-æœºåœºæµ‹é€Ÿå’Œç®€ä»‹](https://duyaoss.com/)

ä¸åŒçš„æœºåœºã€ä¸åŒçš„ä»·æ ¼ã€ä¸åŒçš„äº§å“ä¼šæä¾›ä¸åŒçš„ç¿»å¢™åè®®çš„ä»£ç†æœåŠ¡ï¼Œç›®å‰ä¸»æµçš„ç¿»å¢™åè®®æœ‰ssã€ssrã€VMessã€trojanç­‰æ‰€ä»¥é¦–å…ˆä½ éœ€è¦å¼„æ˜ç™½ä½ çš„ä¾›åº”å•†ç»™ä½ çš„æ˜¯ä»€ä¹ˆç±»å‹çš„èŠ‚ç‚¹ï¼ˆé€šå¸¸éƒ½ä¼šæä¾›ssï¼‰ï¼Œç„¶åæä¾›çš„ç±»å‹é€‰æ‹©å¯¹åº”çš„ä»£ç†å®¢æˆ·ç«¯

é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜éœ€è¦è·å–æœºåœºæä¾›çš„æ‰˜ç®¡ or è®¢é˜…è¿æ¥æ–¹ä¾¿èŠ‚ç‚¹å¯¼å…¥



## ä»£ç†å®¢æˆ·ç«¯

>å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« çš„æ•´ç†ï¼š[SS/SSR/V2Ray/Trojan/Clash ç®€ä»‹å’Œå®¢æˆ·ç«¯è½¯ä»¶ä¸‹è½½](https://congcong0806.github.io/2018/04/20/SS/)

linuxä¸Šå¯ä»¥é€‰æ‹©çš„ä»£ç†å®¢æˆ·ç«¯ä¹ŸæŒºå¤šï¼Œæ¯”è¾ƒæµè¡Œçš„æœ‰ shadowsocks å®¢æˆ·ç«¯ï¼ˆæœ€æµè¡Œçš„ä»£ç†åè®®ï¼Œå¤§å¤šæ•°æœºåœºéƒ½æ”¯æŒï¼‰ï¼Œv2rayè¡ç”Ÿï¼ŒClash ç³»åˆ—ï¼Œä»–ä»¬éƒ½æœ‰å¯¹åº”ä¸åŒå¹³å°çš„GUI/CLIç‰ˆæœ¬ï¼Œè¿™é‡Œç®€å•æœé›†ä¸€ä¸‹æ–¹ä¾¿å¤§å®¶é€‰æ‹©ï¼š

-   [shadowsocks ç¤¾åŒº](https://shadowsocks.org/en/index.html)å®˜æ–¹å®¢æˆ·ç«¯ï¼ˆä»…æ”¯æŒssï¼‰ï¼šhttps://shadowsocks.org/en/download/clients.html
-   [v2ray å®˜ç½‘](https://www.v2ray.com/)åˆ—ä¸¾çš„å®¢æˆ·ç«¯ï¼ˆå¿…ç„¶æ”¯æŒVMessï¼Œå…¶ä»–åè®®æ”¯æŒæƒ…å†µä¸åŒï¼‰ï¼šhttps://www.v2ray.com/awesome/tools.html
    -   æ³¨ï¼šQv2ray [åŸé¡¹ç›®](http://qv2ray.net/)å·²ç»åœæ­¢ç»´æŠ¤ï¼Œä½†æœ‰åŸä½œè€…å¦å¼€é¡¹ç›®æ›´æ–°ç»´æŠ¤ï¼Œ[è¯¦æƒ…è§æ­¤](https://github.com/Shadowsocks-NET/Qv2ray)ï¼ˆç”šè‡³è¿˜å‡ºäº†3.0ç‰ˆæœ¬ï¼ï¼‰
-   [Clash](https://github.com/Dreamacro/clash)ï¼šæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ”¯æŒVMess, Shadowsocks, Trojan, Snellåè®®çš„å¤šå¹³å°ä»£ç†å®¢æˆ·ç«¯ï¼ˆCLIï¼Œä¸€èˆ¬é…åˆweb guiç”¨ï¼‰ï¼Œå›¾å½¢å®¢æˆ·ç«¯çš„è¯æ¨èä¸‹é¢3ä¸ªï¼Œåˆ«çš„ä¸æ¨è
    -   [Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg) ä¸€ä¸ªæ”¯æŒ Windows/macOS/Linux çš„å¾ˆæµè¡Œçš„å›¾å½¢å®¢æˆ·ç«¯ï¼ˆåæ–‡ç®€ç§°CFWï¼‰ï¼Œ**æ¨èä½¿ç”¨**ğŸ˜
    -   [ClashX](https://github.com/yichengchen/clashX)ï¼šClash çš„ Mac å›¾å½¢å®¢æˆ·ç«¯
    -   [ClashForAndroid](https://github.com/Kr328/ClashForAndroid)ï¼šClash çš„ Android å›¾å½¢å®¢æˆ·ç«¯ï¼Œ

ä¸Šé¢é™¤äº† Qv2ray æ–°ç»´æŠ¤ç‰ˆæœ¬ä»¥åŠ ClashX æˆ‘æ²¡ç”¨è¿‡ï¼Œå…¶ä»–çš„å®¢æˆ·ç«¯éƒ½æœ‰ä½¿ç”¨æˆ–è€…æ­£åœ¨ä½¿ç”¨ï¼Œè€ƒè™‘åˆ°åšå®¢ç¯‡å¹…ä»¥åŠç®€å•æ˜“ç”¨çš„åŸåˆ™ï¼Œæˆ‘åœ¨è¿™é‡Œé€‰æ‹©ä½¿ç”¨CFWçš„linuxç‰ˆæœ¬ï¼Œä»–åŸºæœ¬ä¸Šå’Œwinç‰ˆå·®ä¸å¤šï¼Œæ¯”è¾ƒæ–¹ä¾¿ä½¿ç”¨ï¼Œå®¢æˆ·ç«¯é€‰æ‹©é€‚åˆè‡ªå·±çš„å³å¯ï¼Œå¦‚æœä½ æ˜¯å†²æµªå°ç™½ï¼Œå»ºè®®é€‰æ‹©åšä¸»æ¨èçš„CFW

é…ç½®å®¢æˆ·ç«¯çš„æ—¶å€™éœ€è¦æ³¨æ„æä¾›ä»£ç†æœåŠ¡çš„ç›¸åº”ç«¯å£ï¼Œæ¯”å¦‚Clashæ–°ç‰ˆä½¿ç”¨`Mixed Port`å¯ä»¥æä¾›ç«¯å£éƒ½æ˜¯`7890 (default)`çš„httpå’Œsocks5 proxyæœåŠ¡ï¼›è€Œå¦‚æœä½ ä½¿ç”¨shadowsocksä½œä¸ºä½ çš„å®¢æˆ·ç«¯ï¼Œä»–åªèƒ½æä¾›ç«¯å£ä¸º`8080 (default)`çš„socks5 proxyï¼Œç„¶è€Œå¹¶ä¸æ˜¯æ‰€æœ‰åº”ç”¨éƒ½æ”¯æŒsocks5çš„ï¼Œå¤§éƒ¨åˆ†åªæ”¯æŒhttp/https proxyï¼Œæ‰€ä»¥ä½ å¯èƒ½éœ€è¦é¢å¤–ä½¿ç”¨ä¸€äº›å·¥å…·ï¼ˆæ¯”å¦‚ [privoxy](https://www.privoxy.org/) ï¼‰ç›‘å¬socks5ç«¯å£å¹¶å°†å®ƒè½¬æ¢ä¸ºhttp proxy



### CFW å®‰è£…åŠé…ç½®

#### å®‰è£…

åœ¨è¿™é‡Œæä¾›CFWçš„é…ç½®æ–¹æ³•ï¼Œå…¶ä»–å®¢æˆ·ç«¯çš„é…ç½®å¾…æœªæ¥æ›´æ–°ï¼ˆä¸ä¿è¯ï¼‰

>   ä»…ä¾›å‚è€ƒï¼Œè¯·å‹¿æ— è„‘ç…§æ¬å‘½ä»¤

åœ¨CFWçš„ [releases é¡µé¢](https://github.com/Fndroid/clash_for_windows_pkg/releases)ä¸‹æ‰¾åˆ°å¯¹åº”çš„ç‰ˆæœ¬å¤åˆ¶ä¸‹è½½é“¾æ¥ï¼Œå¹¶æ‰“å¼€ç»ˆç«¯ä½¿ç”¨wgetä¸‹è½½å¹¶è§£å‹åˆ°`/usr/local`ï¼ˆä½ ä¹Ÿå¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼ä¸‹è½½å¹¶è§£å‹åˆ°ä½ å¿ƒä»ªçš„ç›®å½•ï¼‰ï¼š

```bash
# åˆ‡æ¢åˆ°ä¸‹è½½ç›®å½•
$ cd ~/Downloads/
# å¯ä»¥è‡ªè¡Œæœ€æ–°ç‰ˆæœ¬ï¼ˆå› ä¸ºgithubæ²¡æœ‰è¢«å¢™ï¼Œæ‰€ä»¥åªæ˜¯ç½‘é€Ÿæ…¢ï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ï¼‰
$ wget https://github.com/Fndroid/clash_for_windows_pkg/releases/download/0.19.12/Clash.for.Windows-0.19.12-x64-linux.tar.gz
# è§£å‹åˆ°å½“å‰æ–‡ä»¶å¤¹
$ tar -xvf Clash.for.Windows-0.19.12-x64-linux.tar.gz
# ç§»åŠ¨åˆ°/usr/local/å¹¶é‡å‘½åä¸ºCFW[å¯é€‰]
$ sudo mv Clash\ for\ Windows-0.19.12-x64-linux/ /usr/local/CFW
# åå°é™é»˜è¿è¡ŒCFW
$ /usr/local/Clash\ for\ Windows/cfw &
```

å¯åŠ¨åå°†ä¼šæœ‰CFWçš„GUIå¼¹å‡ºï¼Œåœ¨å·¦ä¾§`General`æ ä¸­å¯ä»¥çœ‹åˆ°ï¼ˆä½ çš„æ ç›®å¯èƒ½ä¸æˆ‘çš„æœ‰æ‰€ä¸åŒï¼Œè¿™æ˜¯å› ä¸ºæˆ‘çš„æ‰˜ç®¡é…ç½®æä¾›äº†é¢å¤–çš„`Providers`é€‰é¡¹ï¼‰ï¼Œclashé»˜è®¤ä½¿ç”¨çš„ç«¯å£æ˜¯`7890`ï¼Œæˆ‘ä»¬è¦è®°ä½è¿™ä¸ªç«¯å£å·ï¼Œåé¢ä¼šç»å¸¸ä½¿ç”¨

>è€ç‰ˆæœ¬çš„ CFW çš„ `http`ç«¯å£ å’Œ `socks5` ç«¯å£æ˜¯ä¸åŒçš„ï¼Œ æ–°ç‰ˆæœ¬åä½¿ç”¨`Mixed Port` å°±ç»Ÿä¸€æˆ`7890`

![image-20220318135534362](assets/image-20220318135534362.png)



#### å¯¼å…¥ä»£ç†é…ç½®

clashä½¿ç”¨`yaml`æ–‡ä»¶é…ç½®èŠ‚ç‚¹ä¿¡æ¯ï¼ŒCFWä¼šè‡ªåŠ¨è¯»å–`~/.config/clash/profiles/`ä¸‹å­˜æ”¾`.yaml/yml`é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å¤åˆ¶æœºåœºä¾›åº”å•†æä¾›çš„clashæ‰˜ç®¡è¿æ¥ç²˜è´´è‡³`Profiles`å¹¶ç‚¹å‡»ä¸‹è½½å³å¯ä½¿ç”¨

å¦‚æœå¾ˆä¸å¹¸ï¼Œä½ åªæœ‰å¯ä»¥ä½¿ç”¨çš„å°‘é‡èŠ‚ç‚¹éœ€è¦è‡ªè¡Œé…ç½®ï¼Œé‚£ä½ å¯ä»¥ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œç»†èŠ‚è¯·æŸ¥çœ‹[æ­¤æ–‡æ¡£](https://docs.cfw.lbyczf.com/contents/configfile.html#profiles-xxxx-yaml)



#### é…ç½® Service Mode [å¯é€‰]

åœ¨linuxç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„ä»£ç†æ¨¡å¼åªæœ‰å…¨å±€ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨ä¸€äº›é«˜çº§åŠŸèƒ½ï¼ˆæ¯”å¦‚TUN Modeï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…é¢å¤–çš„æ’ä»¶

[å®˜æ–¹æ–‡æ¡£](https://docs.cfw.lbyczf.com/contents/questions.html#service-mode-%E6%97%A0%E6%B3%95%E5%AE%89%E8%A3%85)æä¾›ä»¥ä¸‹å¿«æ·æ–¹å¼ï¼š

```bash
$ curl https://gist.githubusercontent.com/Fndroid/2119fcb5ccb5a543a8f6a609418ae43f/raw/592eba4f480c7ccb4f29c9b8e80d24bfd5dda8cf/linux.sh > cfw-tun.sh && chmod +x cfw-tun.sh && sudo cfw-tun.sh install <cfwå®‰è£…ç›®å½•>
```

åœ¨æœ¬ä¾‹ä¸­ï¼Œ`<cfwå®‰è£…ç›®å½•>`ä¸º`/usr/local/CFW/`

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç‚¹å‡»`Manage`è‡ªåŠ¨å®‰è£…ï¼Œå‰ææ˜¯ç³»ç»Ÿéœ€è¦å…ˆè£…æœ‰`nftables`å’Œ`iproute2`ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·è‡ªåŠ¨å®‰è£…ï¼š

```bash
# ubuntu/kubuntuå¯ä»¥ä½¿ç”¨apt
$ sudo apt install nftables
$ sudo apt install iproute2
```

å®‰è£…å®Œæˆåå†ç‚¹å‡»`Install`

![mage-20220318143611782](assets/Screenshot_20220318_142841.png)

å¦‚æœå®‰è£…æˆåŠŸï¼Œé‡å¯å`General`æ æ˜¾ç¤ºçš„`Service Mode`é¡¹çš„åœ°çƒå›¾æ ‡å°†å˜ä¸ºç»¿è‰²ï¼Œå¯ä»¥å‘ç°å³ä¸‹è§’çš„å°çŒ«å’ªå·²ç»æ”¯æŒå„ç§ä»£ç†æ¨¡å¼äº†ï¼Œè¿™é‡Œçš„è¯æ¨èå¤§å®¶ä½¿ç”¨Ruleæ¨¡å¼ï¼Œå¦‚æœé‡åˆ°ä¸€äº›å¤–å›½ç½‘ç«™æ— æ³•



#### ä½¿ç”¨ TUN/TAP Mode [æ¨è]

éœ€è¦å…ˆå®‰è£…å¥½Service Modeï¼Œå¯¹äºä¸éµå¾ªç³»ç»Ÿä»£ç†çš„è½¯ä»¶ï¼Œ[TUN/TAP](https://en.wikipedia.org/wiki/TUN/TAP) æ¨¡å¼å¯ä»¥æ¥ç®¡å…¶æµé‡å¹¶äº¤ç”± CFW å¤„ç†ï¼Œå› ä¸ºä»–ä»¬åˆ†åˆ«ä½œç”¨åœ¨ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚ï¼Œå°±åƒæ˜¯å®‰è£…äº†ä¸€ä¸ªè™šæ‹Ÿçš„ç¿»å¢™ç½‘å¡ï¼Œæ“ä½œç³»ç»Ÿçš„æ‰€æœ‰åº”ç”¨çš„æµé‡éƒ½äº¤ç»™è¿™ä¸ªç½‘å¡å¤„ç†ï¼Œä½ å¯ä»¥å®ç°çœŸæ­£çš„å…¨å±€ä»£ç†ï¼Œä¸è®ºæ˜¯æµè§ˆå™¨ã€ç»ˆç«¯åº”ç”¨ï¼ˆå¦‚gitï¼‰ã€‚å€ŸåŠ©CFWçš„å¯ä»¥æ–¹ä¾¿ä½ è¿›è¡Œä»£ç†æ¨¡å¼çš„åˆ‡æ¢

è¿™é‡Œæ¨èä½¿ç”¨TUNï¼Œåœ¨Generalé¡µä¸­æ‰“å¼€TUNæ¨¡å¼å¼€å…³å³å¯ã€‚å¦‚æœæƒ³å®‰è£…TAPæ¨¡å¼ï¼Œè¯·è‡ªè¡ŒæŸ¥é˜…[ç›¸å…³èµ„æ–™](https://docs.cfw.lbyczf.com/contents/tap.html)

![Tun-tap-osilayers-diagram](assets/Tun-tap-osilayers-diagram.png)

æˆ‘ä¹‹å‰æ²¡æ€ä¹ˆä½¿ç”¨è¿‡TUNæ¨¡å¼ï¼Œæœ€è¿‘æ‰“å¼€å°è¯•äº†ä¸€æ®µæ—¶é—´æš‚æ—¶æ²¡å‘ç°ä»€ä¹ˆé—®é¢˜ï¼Œä¹Ÿå¯ä»¥curl googleã€git pullï¼Œç”šè‡³è¿dockerä¹Ÿèƒ½ç”¨ï¼ˆä¸‹å›¾ç¬¬ä¸€æ¬¡å‘½ä»¤æœªæ‰“å¼€ï¼‰

![image-20220319101739717](assets/image-20220319101739717.png)

>   ç†è®ºä¸Šï¼Œå¦‚æœä½ ä½¿ç”¨CFWä½œä¸ºå®¢æˆ·ç«¯å¹¶å¼€å¯äº†TUNæ¨¡å¼å¹¶ä¸”èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œé‚£ä¹ˆä»å®ç”¨æ€§çš„è§’åº¦æ¥è¯´æ˜¯ä½ å¯ä»¥**å…³é—­æœ¬æ–‡**äº†ï¼Œå¦‚æœä½ åç»­ä½¿ç”¨å‘ç°TUNæ¨¡å¼å‡ºç°å¾ˆå¤§é—®é¢˜ï¼Œä½ å†å›å¤´çœ‹æœ¬æ–‡é€‰æ‹©åˆ«çš„æ–¹å¼ã€‚

è€ƒè™‘åˆ°ç›®å‰è¿™ç§æ–¹æ³•åªæœ‰å°‘æ•°çš„å®¢æˆ·ç«¯æ”¯æŒï¼Œå¹¶ä¸”ç›¸å…³çš„èµ„æ–™ä¸å¤šï¼Œéš¾ä»¥debugï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯åœ¨åæ–‡æä¾›äº†ä¸€äº›è¾ƒä¸ºé€šç”¨ä¸”æ¯”è¾ƒæµè¡Œçš„æ–¹æ³•ï¼ˆå…¶å®å°±æ˜¯æƒ³æ°´æ–‡ï¼‰



## æµè§ˆå™¨ä»£ç†

>   å¦‚æœä½ ä½¿ç”¨äº†TUNæ¨¡å¼ï¼ˆè¯¦æƒ…è§å‰æ–‡ï¼‰ï¼Œæ— éœ€è¿›è¡Œæ­¤è®¾ç½®

å› ä¸ºkdeçš„ç³»ç»Ÿä»£ç†å°±åƒä¸€ä¸ªç©å…·ï¼Œä¸ä»…å¤§å¤šæ•°åº”ç”¨ä¸ä¼šä½¿ç”¨å…¶ä»£ç†é…ç½®ï¼Œç”šè‡³è¿kdeè‡ªå·±çš„ç³»åˆ—åº”ç”¨ä¹Ÿä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è‡ªè¡Œè¿›è¡Œé…ç½®ï¼Œæ˜¾ç¤ºåœ°é…ç½®äº†å¿ƒé‡Œä¹Ÿè¸å® ğŸ˜Šï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨SwitchyOmega

### Firefox å¼€ç®±å³ç”¨ [å¯é€‰]

>**127.0.0.1(localhost)**æ˜¯ä¸€ä¸ªåœ¨[è®¡ç®—æœºç½‘ç»œ](https://zh.wikipedia.org/wiki/è®¡ç®—æœºç½‘ç»œ)ä¸­ç”¨äºè¡¨ç¤ºâ€œæ­¤è®¡ç®—æœºâ€çš„[ä¸»æœºå](https://zh.wikipedia.org/wiki/ä¸»æœºå)ã€‚å®ƒè¢«ç”¨äºé€šè¿‡[æœ¬åœ°ç¯å›](https://zh.wikipedia.org/wiki/å›ç¯ç½‘å¡)ç½‘ç»œæ¥å£ï¼Œæ¥è®¿é—®æœ¬æœºè¿è¡Œçš„æœåŠ¡ï¼Œå¹¶ä¸”å°†ä¼šç»•è¿‡ä»»ä½•ç‰©ç†ç½‘ç»œæ¥å£ç¡¬ä»¶ï¼Œè¯¦æƒ…è¯·è§[ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/Localhost)

ä»£ç†å®¢æˆ·ç«¯æ­£å¸¸å¯åŠ¨åï¼Œæ ¹æ®æœåŠ¡çš„ç«¯å£è¿›è¡Œé…ç½®ï¼Œclashé»˜è®¤ä½¿ç”¨çš„æ˜¯7890ç«¯å£ï¼Œæ‰“å¼€æµè§ˆå™¨ä»£ç†è®¾ç½®ï¼ˆå¯ä»¥æœç´¢å…³é”®å­—proxyï¼‰ï¼Œé€‰æ‹© socks5 (å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯http/httpsï¼Œä¸è¿‡socks5æ•ˆç‡æ›´é«˜æ‰€ä»¥é€‰æ‹©å®ƒ)å¹¶è¾“å…¥`127.0.0.1:7890`å³å¯é…ç½®æˆåŠŸã€‚æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯åˆ«çš„å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚ssï¼‰ï¼Œè¯·å°†`7890`æ›¿æ¢æˆä½ çš„ç«¯å£è®¾ç½®ï¼Œåˆ‡å‹¿æ— è„‘ç…§æ¬

![image-20220318230659072](assets/image-20220318230659072.png)

è¿™æ ·è®¾ç½®ä»…å¯ä»¥ä½¿ Firefox ä½¿ç”¨å…¨å±€ä»£ç†ï¼Œä½†æ˜¯æ²¡æœ‰æ›´å¤šçš„é…ç½®æ”¯æŒï¼Œå»ºè®®ä¸´æ—¶ä½¿ç”¨ã€‚è€Œ Edgeã€Chrome ä¸åŸç”Ÿæ”¯æŒä»£ç†è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶æ¥ä½¿ç”¨ä»£ç†ï¼Œ

 

### ä½¿ç”¨Proxy SwitchyOmega [æ¨è]

Proxy SwitchyOmega æ˜¯ Chrome å’Œ Firefox æµè§ˆå™¨ä¸Šçš„ä»£ç†æ‰©å±•ç¨‹åºï¼Œå¯ä»¥è½»æ¾å¿«æ·çš„ç®¡ç†å’Œåˆ‡æ¢å¤šä¸ªä»£ç†è®¾ç½®ï¼Œå¯ä»¥è½»æ¾åœ¨ Chrome å’Œ Firefox çš„åº”ç”¨å•†åº—ä¸Šå®‰è£…ï¼Œä½†å¦‚æœè¦è®¿é—®ä»–ä»¬çš„åº”ç”¨å•†åº—éœ€è¦å…ˆç¿»å¢™ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ã€‚å¹¸è¿çš„æ˜¯ï¼Œswitchyomegaçš„å®˜ç½‘å¥½åƒæ²¡è¢«å¢™ï¼Œå¯ä»¥æŒ‰ç…§[å®˜ç½‘å®‰è£…æ•™ç¨‹](https://proxy-switchyomega.com/download/)è¿›è¡Œç¦»çº¿å®‰è£…ï¼Œä»¥ä¸‹æ˜¯SwitchyOmegaçš„æµè§ˆå™¨å•†åº—é¡µé¢ï¼š

-   [Chrome/Chromium/Edge](https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif/related?hl=zh-CN) ï¼šç”±äºæ–°ç‰ˆEdgeä½¿ç”¨Chromiumå†…æ ¸ï¼Œæ‰€ä»¥Edgeå¯ä»¥ç›´æ¥å®‰è£…chromeå•†åº—çš„æ‰©å±•
-   [Firefox/Mozilla](https://addons.mozilla.org/zh-CN/firefox/addon/switchyomega/)
-   [Proxy SwitchyOmega For Edge (unofficial)](https://microsoftedge.microsoft.com/addons/detail/proxy-switchyomega/fdbloeknjpnloaggplaobopplkdhnikc?msclkid=3f969f06a5f611ec9f9e9afd7840d5bd) è¯·æ³¨æ„ï¼åœ¨Edgeå•†åº—ä¸­çš„è¿™æ˜¯éå®˜æ–¹ç‰ˆæœ¬ä¸”ä»£ç æœªå¼€æºçš„æé¬¼ï¼Œä¸æ¨èå¤§å®¶ä½¿ç”¨

å®‰è£…å¥½åç‚¹å‡»å³ä¸Šè§’SwitchyOmegaçš„æ‰©å±•è®¾ç½®ï¼Œåœ¨proxyæ ä¸­è¾“å…¥ä»£ç†è®¾ç½®å³å¯ï¼Œå·¦è¾¹applyä¿å­˜åå†ç‚¹å‡»å°åœ†åœˆé€‰æ‹©ä½¿ç”¨proxyå³å¯

![image-20220319103628994](assets/image-20220319103628994.png)



## ç»ˆç«¯ä»£ç†

>   å¦‚æœä½ ä½¿ç”¨äº†TUNæ¨¡å¼ï¼ˆè¯¦æƒ…è§å‰æ–‡ï¼‰ï¼Œæ— éœ€è¿›è¡Œæ­¤è®¾ç½®

é€šå¸¸æƒ…å†µä¸‹ï¼Œç»ˆç«¯æ˜¯æ— æ³•ä½¿ç”¨ç³»ç»Ÿä»£ç†çš„ï¼Œè¿™éœ€è¦æˆ‘ä»¬è‡ªè¡Œé…ç½®

### export ä»£ç†ç¯å¢ƒå˜é‡

åŸºæœ¬çš„ä½¿ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ export è®¾ç½®å½“å‰ç»ˆç«¯çš„ä»£ç†ç¯å¢ƒå˜é‡ï¼š

```bash
# http proxy
$ export http_proxy="http://host:port"
$ export https_proxy="https://host:port"
# socks5 proxy
$ export http_proxy="socks5://host:port"
$ export https_proxy="socks5://host:port"
# ä¹‹åå°±å¯ä»¥è¿è¡Œæƒ³è¦ä½¿ç”¨ä»£ç†çš„åº”ç”¨
$ some commands
```

å¯¹äºæœ¬ä¾‹ï¼ˆCFWï¼‰ï¼Œä»£ç å¦‚ä¸‹ã€‚å†æ¬¡å¼ºè°ƒï¼Œåªæ˜¯clashä½¿ç”¨äº†mixed portæ‰å¯ä»¥ä½¿å¾—ç«¯å£éƒ½æ˜¯7890

```bash
# http proxy
$ export http_proxy="http://127.0.0.1:7890"
$ export https_proxy="https://127.0.0.1:7890"
# socks5 proxy
$ export http_proxy="socks5://127.0.0.1:7890"
$ export https_proxy="socks5://127.0.0.1:7890"
```

è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯åªä¼šä½œç”¨åœ¨å½“å‰ç»ˆç«¯ï¼Œå¦‚æœå…³é—­äº†ä¸‹æ¬¡è¿˜è¦é‡æ–°é…ç½®ä¸€æ¬¡ï¼Œç½‘ä¸Šç»å¸¸ä¼šå°†è¿™ç§æ–¹å¼å†™å…¥åˆ°`~/.bashrc`æ°¸ä¹…ä¿å­˜é‡Œæ–¹ä¾¿ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘å¹¶ä¸æ¨èè¿™ä¹ˆåšï¼ˆè¿™æ ·ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä¼šå¼„å¾—è„è„çš„ï¼‰æ‰€ä»¥æˆ‘è¿™é‡Œä¹Ÿä¸æä¾›ï¼Œå®åœ¨æœ‰è¿™ç§éœ€æ±‚è¯·è‡ªè¡ŒæŸ¥é˜…èµ„æ–™

ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä¸Šé¢æ˜¯ä¸€æ¬¡æ€§çš„ï¼‰ï¼Œæœ‰ç‚¹åƒâ€œç»ˆç«¯ç‰ˆæœ¬çš„ç³»ç»Ÿä»£ç†â€ï¼Œèƒ½å¦å‘æŒ¥ä½œç”¨å®Œå…¨çœ‹CLIåº”ç”¨æ˜¯å¦è¯»å–ï¼Œæ¯”å¦‚æ¯”å¦‚aptã€dockerç­‰å°±ä¸ä¼šè¯»å–ï¼Œè‡ªç„¶ä¹Ÿæ— æ³•ä½¿ç”¨ä»£ç†ï¼Œè¿™æ—¶å€™éœ€è¦ä½¿ç”¨é¢å¤–çš„å·¥å…·å¼ºåˆ¶å…¶èµ°ä»£ç†



### ä½¿ç”¨ proxychains [æ¨è]

>   ProxyChainsæ˜¯Linuxå’Œå…¶ä»–Unicesä¸‹çš„ä»£ç†å·¥å…·ã€‚å®ƒå¯ä»¥ä½¿ä»»ä½•ç¨‹åºé€šè¿‡ä»£ç†ä¸Šç½‘ï¼Œå…è®¸TCPå’ŒDNSé€šè¿‡ä»£ç†éš§é“ï¼Œæ”¯æŒHTTPã€SOCKS4å’ŒSOCKS5ç±»å‹çš„ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”å¯é…ç½®å¤šä¸ªä»£ç†ã€‚ProxyChainsé€šè¿‡ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ä»£ç†åˆ—è¡¨å¼ºåˆ¶è¿æ¥æŒ‡å®šçš„åº”ç”¨ç¨‹åºï¼Œç›´æ¥æ–­å¼€æ¥æ”¶æ–¹å’Œå‘é€æ–¹çš„è¿æ¥ã€‚

ç»å¸ƒé²æ–¯å®æµ‹ï¼Œå¤§å¤šæ•°åº”ç”¨æ¯”å¦‚ gitã€aptã€curlã€wget å¯ä»¥æˆåŠŸä½¿ç”¨ proxychains ä»£ç†ï¼Œå°‘æ•°å¦‚ docker åˆ™ä¸å¯ä½¿ç”¨

proxychains-ng æ˜¯proxychainsçš„æ–°ç‰ˆæœ¬ï¼Œç›´æ¥ç”¨åŒ…ç®¡ç†å·¥å…·å°±å¯ä»¥å®‰è£…

```bash
$ sudo apt install proxychains4
```

ä¹Ÿå¯ä»¥ç”¨æºç å®‰è£…

```bash
$ git clone git@github.com:rofl0r/proxychains-ng.git
$ sudo make
$ sudo make install
$ sudo make install-config
```

å®‰è£…å®Œä¹‹åä¿®æ”¹`/etc/proxychains4.conf`æ–‡ä»¶ï¼ŒåŠ å…¥ä»£ç†é…ç½®å³å¯ï¼Œæœ¬ä¾‹ï¼ˆCFWï¼‰ä¿®æ”¹å¦‚ä¸‹ï¼š

```conf
[ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
http 127.0.0.1 7890
socks5 127.0.0.1 7890
```

é…ç½®å¥½ä¹‹åï¼Œåœ¨æƒ³è¦ä½¿ç”¨ä»£ç†çš„æƒ…å†µä¸‹åŠ ä¸Š`proxychains4`å‰ç¼€å³å¯ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š

```bash
$ proxychains4 curl -L www.google.com
$ proxychains4 git clone xxx.git
```



## å…¶ä»–è®¾ç½®

### ä½¿ç”¨ privoxy å°† socks5 è½¬ä¸º http ä»£ç†

å‰æ–‡æœ‰æåˆ°ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨sså®¢æˆ·ç«¯æˆ–è€…å…¶ä»–åªæä¾›socks5 proxyæœåŠ¡çš„å®¢æˆ·ç«¯çš„è¯ï¼Œé‚£ä¹ˆä½ å¾ˆéœ€è¦é¢å¤–é…ç½®ä¸€ä¸ªhttp proxyï¼Œè¿™æ˜¯å› ä¸ºæœ‰å¾ˆå¤šåº”ç”¨ä¸æ”¯æŒsocks5ï¼Œæ¯”å¦‚wget

```bash
$ export http_proxy=socks5://127.0.0.1:7890
$ wget www.google.com
Error parsing proxy URL socks5://127.0.0.1:7890: Unsupported scheme â€˜socks5â€™.

$ export http_proxy=http://127.0.0.1:7890
$ wget www.google.com
--2022-03-19 14:50:04--  http://www.google.com/
Connecting to 127.0.0.1:7890... connected.
```

ä½ éœ€è¦ä½¿ç”¨ [privoxy](http://www.privoxy.org/) å°† socks5 è½¬ä¸º http ä»£ç†ï¼Œä½¿ç”¨åŒ…ç®¡ç†å·¥å…·å®‰è£…å¹¶é…ç½®ï¼š

```bash
$ sudo apt install privoxy
# åœ¨é…ç½®æ–‡ä»¶æœ«å°¾åŠ ä¸Šä»£ç†é…ç½®
$ echo "forward-socks5t   /  <host:port> ." | sudo tee -a /etc/privoxy/config
# æœ¬ä¾‹å¦‚ä¸‹ï¼Œå¦‚æœä½ æ˜¯ä½¿ç”¨ssçš„è¯ï¼Œåº”è¯¥æ˜¯8080ç«¯å£
$ echo "forward-socks5t   /  127.0.0.1:7890 ." | sudo tee -a /etc/privoxy/config
# é‡å¯æœåŠ¡å³å¯ä½¿ç”¨
$ sudo systemctl restart privoxy.service
$ sudo systemctl enable privoxy.service
```

ç°åœ¨ï¼Œä½ å°†è·å¾—ä¸€ä¸ªhttp proxyä¸º`http://127.0.0.1:8118`ï¼Œ`8118`æ˜¯`privoxy`é»˜è®¤çš„æœåŠ¡ç›‘å¬ç«¯å£ï¼Œç„¶åä½ å°±å¯ä»¥ä½¿ç”¨`http://127.0.0.1:8118`ä½œä¸ºä½ çš„http proxyä½¿ç”¨åœ¨å‰æ–‡çš„é…ç½®ä¸­äº†





